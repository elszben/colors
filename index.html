<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>RYB Color Mixing Game</title>
  <style>
    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      width: 100%;
      background: #fafafa;
    }

    body {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1rem;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .color-row {
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
      width: 100%;
      max-width: 600px;
    }

    .color-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .color-box {
      width: 100%;
      height: 100px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .ryb-label {
      font-weight: bold;
      margin: 6px 0 4px;
    }

    .info {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .info input[type="color"] {
      width: 100%;
      max-width: 300px;
      height: 50px;
      border: none;
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
    }

    #mixButton {
      padding: 10px 20px;
      font-size: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    .turn-history {
      width: 100%;
      max-width: 600px;
      margin-top: 1rem;
    }

    .turn-entry {
      display: flex;
      align-items: stretch;
      gap: 10px;
      margin-bottom: 10px;
      padding: 0.5rem;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .turn-entry .color-box {
      flex: 1;
      height: 100px;
      border-radius: 6px;
    }

    .percentage {
      margin-left: 10px;
      font-weight: bold;
      min-width: 80px;
    }

    .ryb-bars {
      display: flex;
      flex-direction: column;
      margin-left: 10px;
      font-size: 0.9em;
    }

    .ryb-bar {
      display: flex;
      align-items: center;
      margin-bottom: 2px;
    }

    .ryb-bar div:first-child {
      width: 20px;
      height: 20px;
      margin-right: 6px;
      border: 1px solid #000;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <h1>ðŸŽ¨ RYB Color Mixing Game</h1>

  <div class="info">
    <div class="color-row">
      <div class="color-column">
        <div class="color-box" id="targetColor"></div>
        <div class="ryb-label">Target</div>
        <div id="targetRYB" class="ryb-bars"></div>
      </div>
      <div class="color-column">
        <div class="color-box" id="currentColor"></div>
        <div class="ryb-label">Start</div>
        <div id="startRYB" class="ryb-bars"></div>
      </div>
    </div>
    <div>
      <label for="colorPicker">Pick a color:</label>
      <input type="color" id="colorPicker" />
      <button id="mixButton">Mix</button>
    </div>
    <p>Turn: <span id="turnCount">0</span>/6</p>
  </div>

  <div class="turn-history" id="turnHistory">
    <h2>History</h2>
  </div>

  <script>
    const targetBox = document.getElementById("targetColor");
    const currentBox = document.getElementById("currentColor");
    const colorPicker = document.getElementById("colorPicker");
    const mixButton = document.getElementById("mixButton");
    const turnCountSpan = document.getElementById("turnCount");
    const turnHistory = document.getElementById("turnHistory");

    let turn = 0;
    const maxTurns = 6;

    let targetColor = randomColor();
    let currentColor = randomColor();

    updateDisplay();

    updateRYBBars("targetRYB", targetColor, "Target");
    updateRYBBars("startRYB", currentColor, "Start");

    mixButton.addEventListener("click", () => {
      if (turn >= maxTurns) return;

      const pickedColor = hexToRgb(colorPicker.value);
      currentColor = mixColors(currentColor, pickedColor);
      turn++;

      const distance = colorDistance(currentColor, targetColor);
      const percent = Math.round((1 - distance) * 100);

      const entry = document.createElement("div");
      entry.className = "turn-entry";

      const resultBox = document.createElement("div");
      resultBox.className = "color-box";
      resultBox.style.backgroundColor = rgbToHex(currentColor);

      const percentage = document.createElement("div");
      percentage.className = "percentage";
      percentage.textContent = `${percent}% match`;

      const rybBars = document.createElement("div");
      rybBars.className = "ryb-bars";

      const ryb = approximateRYB(currentColor);

      const components = [
        { name: "R", value: ryb.r, color: "red" },
        { name: "Y", value: ryb.y, color: "gold" },
        { name: "B", value: ryb.b, color: "blue" }
      ];

      components.forEach(comp => {
        const bar = document.createElement("div");
        bar.className = "ryb-bar";

        const colorRect = document.createElement("div");
        colorRect.style.width = "20px";
        colorRect.style.height = "20px";
        colorRect.style.backgroundColor = comp.color;
        colorRect.style.marginRight = "6px";
        colorRect.style.border = "1px solid #000";

        const label = document.createElement("div");
        label.textContent = `${comp.name}: ${Math.round(comp.value)}%`;

        bar.appendChild(colorRect);
        bar.appendChild(label);
        rybBars.appendChild(bar);
      });

      entry.appendChild(resultBox);
      entry.appendChild(percentage);
      entry.appendChild(rybBars);
      turnHistory.appendChild(entry);

      updateDisplay();

      if (turn === maxTurns) {
        alert(`Game over! You reached ${percent}% similarity.`);
      }
    });

    function updateDisplay() {
      targetBox.style.backgroundColor = rgbToHex(targetColor);
      currentBox.style.backgroundColor = rgbToHex(currentColor);
      turnCountSpan.textContent = turn;
    }

    function mixColors(c1, c2) {
      return {
        r: Math.floor((c1.r + c2.r) / 2),
        g: Math.floor((c1.g + c2.g) / 2),
        b: Math.floor((c1.b + c2.b) / 2)
      };
    }

    function rgbToHex({ r, g, b }) {
      return `#${[r, g, b].map(x => x.toString(16).padStart(2, "0")).join("")}`;
    }

    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
      };
    }

    function colorDistance(c1, c2) {
      const dr = c1.r - c2.r;
      const dg = c1.g - c2.g;
      const db = c1.b - c2.b;
      return Math.sqrt(dr * dr + dg * dg + db * db) / Math.sqrt(3 * 255 * 255);
    }

    function randomColor() {
      return {
        r: Math.floor(Math.random() * 256),
        g: Math.floor(Math.random() * 256),
        b: Math.floor(Math.random() * 256)
      };
    }

    // Approximate RYB decomposition from RGB
    function approximateRYB({ r, g, b }) {
      const rf = r / 255;
      const gf = g / 255;
      const bf = b / 255;

      const red = Math.max(0, rf - bf * 0.5 - gf * 0.5);
      const yellow = Math.min(rf, gf);
      const blue = Math.max(0, bf - rf * 0.3 - gf * 0.3);

      const total = red + yellow + blue || 1;

      return {
        r: (red / total) * 100,
        y: (yellow / total) * 100,
        b: (blue / total) * 100
      };
    }

    function updateRYBBars(containerId, color, labelText) {
      const container = document.getElementById(containerId);
      container.innerHTML = ""; // Clear previous bars

      const ryb = approximateRYB(color);
      const components = [
        { name: "R", value: ryb.r, color: "red" },
        { name: "Y", value: ryb.y, color: "gold" },
        { name: "B", value: ryb.b, color: "blue" }
      ];

      components.forEach(comp => {
        const bar = document.createElement("div");
        bar.className = "ryb-bar";

        const rect = document.createElement("div");
        rect.style.backgroundColor = comp.color;

        const label = document.createElement("div");
        label.textContent = `${comp.name}: ${Math.round(comp.value)}%`;

        bar.appendChild(rect);
        bar.appendChild(label);
        container.appendChild(bar);
      });
    }
  </script>
</body>

</html>